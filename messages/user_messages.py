import re
from typing import List

from aiogram.types import SuccessfulPayment
from asyncpg import Record


class UserMessages:

    def __init__(self):
        self.not_active_event = '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ'
        self.reminder = ('üëã–í–æ–∑–º–æ–∂–Ω–æ –≤–∞—Å —á—Ç–æ-—Ç–æ –æ—Ç–≤–ª–µ–∫–ª–æ‚Ä¶\n\n'
                         '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω–æ–µ, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚ö°Ô∏è –ö—É–ø–∏—Ç—å" –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –º–µ—Å—Ç–æ!\n\n'
                         '–ê –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –Ω–∞—à–µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìû –ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫" üëá')
        self.ask_phone = ("‚ùáÔ∏è –ß—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è, –Ω–∞–∂–º–∏—Ç–µ 'üì≤ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç'\n\n"
                          "‚ùó –ö–Ω–æ–ø–∫–∞ –ø–æ–¥ —Å—Ç—Ä–æ–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π\n"
                          "–ï—Å–ª–∏ –Ω–µ –≤–∏–¥–Ω–æ –∫–Ω–æ–ø–∫–∏, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫ —Å —á–µ—Ç—ã—Ä—å–º—è —Ç–æ—á–∫–∞–º–∏, —Å–ø—Ä–∞–≤–∞ –æ—Ç —Å—Ç—Ä–æ–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.")
        self.successful_contact = '‚òÄÔ∏è –°–ø–∞—Å–∏–±–æ! –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –º—ã –≤–∞–º –ø–æ–∑–≤–æ–Ω–∏–º!'

    @staticmethod
    def event_description(description: str) -> str:
        formatted_description = (
            description.replace('<br>', '').replace('&nbsp;', '')
            .replace('–î–∞—Ç–∞', 'üóì –î–∞—Ç–∞').replace('–í—Ä–µ–º—è', 'üï∞ –í—Ä–µ–º—è')
            .replace('–°—Ç–æ–∏–º–æ—Å—Ç—å', 'üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å').replace('–õ–æ–∫–∞—Ü–∏—è', 'üìç –õ–æ–∫–∞—Ü–∏—è')
            .replace('–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', 'üï∞ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å')
        )
        pattern = r"(–õ–æ–∫–∞—Ü–∏—è:)(.*?)(\s)(https://.+)"
        formatted_text = re.sub(pattern, r'\1<a href="\4">\2</a>', formatted_description)
        return formatted_text

    @staticmethod
    def buttons_stat(buttons_data: List[Record]) -> str:
        if buttons_data:
            msg_usual = '[B]–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫–Ω–æ–ø–∫–∞–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π[/B]\n\n'
            msg_buying = '[B]–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫–Ω–æ–ø–∫–∞–º –ø–æ–∫—É–ø–∫–∏[/B]\n\n'
            for record in buttons_data:
                if record.get('button_name').find('–ö—É–ø–∏—Ç—å') == -1:
                    msg_usual += f'[I]{record.get("button_name")}[/I] ({record.get("count")})\n'
                else:
                    msg_buying += f'[I]{record.get("button_name")}[/I] ({record.get("count")})\n'
            return f'{msg_usual}\n{msg_buying}' if msg_buying.split('\n\n')[1] != '' else msg_usual
        return '[B]–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–∂–∏–º–∞–ª –Ω–∞ –∫–Ω–æ–ø–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –≤ —á–∞—Ç-–±–æ—Ç–µ[/B]'

    @staticmethod
    def other_payment(deal_id: int, event_name: str, product_price: float, method: str) -> str:
        order_part = ('–í–∞—à –∑–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω!\n\n'
                      '<b>–ü–æ–¥—Ä–æ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ –∑–∞–∫–∞–∑–∞:</b>\n'
                      f'<b>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</b>: <code>{deal_id}</code>\n'
                      f'<b>–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</b>: <code>{event_name}</code>\n'
                      f'<b>–°—Ç–æ–∏–º–æ—Å—Ç—å</b>: <code>{product_price} PLN</code>\n\n')
        method_part = (f'‚ùì <b><u>–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å</u></b>\n'
                       f'–û–ø–ª–∞—Ç–∏—Ç—å —Å –ø–æ–º–æ—â—å—é BLIK –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º (–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):\n\n'
                       f'‚òéÔ∏è –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞: <code>690265990</code>\n'
                       f'üë§ –ü–æ–ª—É—á–∞—Ç–µ–ª—å: <code>Rudneva Volha</code>\n'
                       f'‚öôÔ∏è –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞: <code>{deal_id}</code>\n\n') \
            if method == 'blik' else \
            (f'‚ùì <b><u>–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å</u></b>\n'
             f'–û–ø–ª–∞—Ç–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á—ë—Ç –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º (–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):\n\n'
             f'#Ô∏è‚É£ –ù–æ–º–µ—Ä —Å—á–µ—Ç–∞: <code>93 1090 2486 0000 0001 4922 9086</code>\n'
             f'üë§ –ü–æ–ª—É—á–∞—Ç–µ–ª—å: <code>Rudneva Volha</code>\n'
             f'‚öôÔ∏è –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞: <code>{deal_id}</code>\n\n')
        information_part = (f'‚ÄºÔ∏è –í–Ω–∏–º–∞–Ω–∏–µ ‚ÄºÔ∏è –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–æ! '
                            f'–ò–Ω–∞—á–µ –º—ã <u>–Ω–µ —Å–º–æ–∂–µ–º –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –í–∞—à –ø–ª–∞—Ç–µ–∂!</u>\n\n'
                            f'–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞ 24 —á–∞—Å–∞, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ - '
                            f'–í–∞–º –ø—Ä–∏–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞.\n–î–æ –≤—Å—Ç—Ä–µ—á–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏!')
        return f'{order_part}{method_part}{information_part}'

    @staticmethod
    def successful_payment(payment_data: SuccessfulPayment, product_name: str) -> str:
        currency = payment_data.currency
        total_amount = payment_data.total_amount
        deal_id = int(payment_data.invoice_payload.split(':')[1])
        provider_payment_charge_id = payment_data.provider_payment_charge_id
        return ('–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–ø–ª–∞—Ç—É!\n\n'
                '<b>–ü–æ–¥—Ä–æ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ –∑–∞–∫–∞–∑–∞:</b>\n'
                f'<b>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</b>: <code>{deal_id}</code>\n'
                f'<b>–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</b>: <code>{product_name}</code>\n'
                f'<b>–°—Ç–æ–∏–º–æ—Å—Ç—å</b>: <code>{total_amount / 100} {currency}</code>\n'
                f'<b>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–ª–∞—Ç–µ–∂–∞:</b>: <code>{provider_payment_charge_id}</code>\n')

    @staticmethod
    def custom_send() -> str:
        return ("19.10 —á–µ—Ç–≤–µ—Ä–≥ –≤ 18.00\n\n"
                "<b>–ë–∏–∑–Ω–µ—Å - —É–∂–∏–Ω</b>\n\n"
                "–ö–ª–∞—Å—Å–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è, –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π –∏–∑ –í—Ä–æ—Ü–ª–∞–≤–∞, –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Ä–µ—à–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å - –∑–∞–ø—Ä–æ—Å–æ–≤\n\n"
                "–¢–µ–º—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è:\n\n"
                "- —Ä–∞–∑–≤–∏—Ç–∏–µ –æ—Ñ—Ñ–ª–∞–π–Ω –±–∏–∑–Ω–µ—Å–∞;\n"
                "- –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –∏ –Ω–∞–ª–æ–≥–∏;\n"
                "- –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ;\n"
                "- –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ;\n"
                "- –ø–æ–¥–±–æ—Ä —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –∏ –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤;\n"
                "- –ø—Ä–æ–¥–∞–∂–∏ –∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤;\n"
                "- –≤—ã—Ö–æ–¥ –Ω–∞ –∑–∞—Ä—É–±–µ–∂–Ω—ã–π —Ä—ã–Ω–æ–∫.\n\n"
                "üï∞ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 2-2,5 —á–∞—Å–∞\n"
                "üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: 50 –∑–ª\n"
                'üìç –õ–æ–∫–∞—Ü–∏—è: <a href="https://maps.app.goo.gl/q9pjcudCcBnvcHts5">Ristorante Pizzeria O Sole Mio, 16/17, Rynek, Wroc≈Çaw</a>')
